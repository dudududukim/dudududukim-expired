---
layout: post
title: d2f
subtitle : (ongoing)
tags: [project, mind]
# feature-title: Korea Univ.
feature-img: "assets/img/dark_room.jpg"
---

d2f projects that i'm planning to finish within 1 month (February) ğŸ™‚â€â†”ï¸

## ğŸš€ d2f (Temporary Name)
> ğŸ“† 24.01.31 ~ 

<br>
### ğŸ›  Tech Stack
- mlx framework
- python
- matlab
- etc...

<br>
### ğŸ¯ Why Start This?
Since I'm unsure about what I want to beâ€”a businessman, a startup member, a personal developer, or something elseâ€”I've been feeling uneasy these days. However, one thing I've realized is that I have a strong desire to solve my own problems or fulfill my own needs by learning new skills, such as AI, circuit design, and system development. Whether intentional or not, I have a day off today, so I'm setting aside my future plans and immersing myself in this project.

**Final goal** is : 
1. making active users with my product
2. finishing with a level of completeness that makes it presentable

Praying for myself ğŸ§¯

<br>
## ğŸ“ Issues

#### <br>*1. mlx.data.buffer_from_vector*
**error** : dictionaryë¡œ êµ¬ì„±ëœ sample = [{'image' : b'Path/'}], 

ì´ê±°ë¥¼ buffer_from_vectorë¥¼ mlx.dataë¡œ ì‹¤í–‰í•˜ë©´ byte arrayê°€ ë„˜ì–´ì™€ì•¼í•˜ëŠ”ë°, ë¹ˆë°°ì—´ì´ ë„˜ì–´ì˜´ ([] dtype=int8)

**Solution** : 

Mac ì´ˆê¸°í™” -> mlx-dataë¥¼ pipë¡œ installí•˜ì§€ ì•Šê³  ì†ŒìŠ¤ì½”ë“œì—ì„œ python blindingìœ¼ë¡œ ì„¤ì¹˜í•¨

(í™˜ê²½ë³€ìˆ˜ì™€ ë‹¤ì–‘í•œ dependencyê°€ ê¼¬ì—¬ìˆë˜ ê²ƒìœ¼ë¡œ íŒŒë‹¨ë¨)

#### <br>*2. mlx framework insights*
**Buffer** : imageë¥¼ í•„ìš”ì‹œì— loadí•˜ì—¬ ë¶ˆí•„ìš”í•˜ê²Œ loadë˜ëŠ” ê²½ìš°ë¥¼ ë§‰ëŠ”ë‹¤. -> ì• í”Œì´ ì§€ë¦¬ê¸´í•˜ëŠ”ë“¯ (ê²°êµ­ Apple siliconì„ ë§Œë“ ì´ìƒ ê·¸ë“¤ì˜ frameworkì™€ protocol ê°œë°œì€ ë¶ˆê°€í”¼í•˜ê³ , ì—¬ê¸°ì„œë„ ë§Œì•½ì— ë‘ê°ì„ ë“œëŸ¬ë‚¸ë‹¤ë©´ ê²°êµ­ ì• í”Œ ì‚¬ì´í´ ë‹¤ì‹œ ì˜¨ë‹¤ê³  ë´„)


**stream.prefetch(4, 4)** : CPUì—ì„œ 4ê°œì˜ batchë¥¼ GPUì—°ì‚°ë™ì•ˆ loadí•´ë‘ê³ , GPUë„ 4ê°œì˜ batchë¥¼ í•œë²ˆì— ë¶ˆëŸ¬ë“œë¦¬ë„ë¡ ì„¤ì •í•¨

#### <br>*3. binary cross entropyì—ì„œ mx.compile ë¬¸ì œ*

í•´ê²° ëª»í•¨ â¡ï¸ ê·¸ëƒ¥ num_classes=2 ë¡œ í•˜ê³  mlx.nn.losses.cross_entropyë¡œ í•¨

binary cross entropyì—ì„œ @partial(mx.compile) ì˜µì…˜ì—ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” ë“¯í•¨

#### <br> *4. Training overfitting (resent44)*

training dataê°€ 204ê°œì—ì„œ trainingì´ overfittingì´ ë°œê²¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ë‹¤.

ë°ì´í„°ëŠ” (224,224) center cropë˜ì–´ ì‚¬ìš©ë˜ì—ˆê³ , batch_size = 16, epoch=50, lr=1e-5

| Epoch | Train Loss | Train Accuracy | Test Accuracy |
|-------|-----------|---------------|--------------|
| 49    | 0.040     | 0.990         | 0.688        |

ğŸ“™ ì´ìœ ? ì•„ë§ˆë„ dataê°€ ë¶€ì¡±í•œë“¯ í•˜ë‹¤. image cropê¹Œì§€ëŠ” ì–´ë–»ê²Œ í•˜ê¸´í•˜ëŠ”ë°, cropë³´ë‹¤ëŠ” 224,224 ë°ì´í„°ë¥¼ ìƒˆë¡œ ìƒì„±í•´ì„œ ì§„í–‰í•´ì•¼ê² ë‹¤.

#### <br> *5. 224,224ë¡œ ì´ë¯¸ì§€ ìª¼ê°œì„œ í•™ìŠµ ì§„í–‰*

ğŸ’¾ ì›ë˜ ë°ì´í„° : 1.02GB -> 743MB (6.13GB disk)

train length : 42111  
Test length : 4678 

ğŸ™‹ğŸ¾â€â™‚ï¸ í–ˆëŠ”ë°ë„ training accëŠ” 1ì— epoch1ë§Œì— ìˆ˜ë ´í•˜ëŠ”ë°, test accurëŠ” ì„œì„œíˆ ì˜¬ë¼ê°€ê¸´í•˜ë‚˜ **overfittingì„** ë³´ì„

ì‚¬ì‹¤ ë‚´ê°€ ì–´ë–¤ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ê±°ë‚˜ ê³µë¶€ë¥¼ ì§„í–‰í• ë•Œ í•­ìƒ ì´ëŸ¬í•œ ë„˜ê¸° ê·€ì°®ì€ ë¬¸ì œë“¤ì—ì„œ í¬ê¸°í•˜ê³  ê·¸ëƒ¥ í•™êµë‚˜ ì‚¬íšŒì—ì„œ ì£¼ì–´ì§„ ê²ƒë“¤ì„ ì—´ì‹¬íˆ í•˜ê¸° ìœ„í•´ì„œ ëŒì•„ê°”ì—ˆë‹¤.
ê·¸ëŸ°ë° ì´ë²ˆ í•œë‹¬ì˜ ëª©í‘œë¥¼ ì´ëŸ¬í•œ ë‚˜ë¥¼ ë§ˆì£¼í•˜ê³  ê·¸ëŸ¬í•œ í—ˆë“¤ì„ ì¹¨ì°©ê³  ì¡°ìš©íˆ ê¾¸ì¤€í•˜ê²Œ ë„˜ì–´ê°€ë ¤ê³  í•œë‹¤.
ì´ë²ˆì—ë„ ì‚¬ì‹¤ ê·¸ëƒ¥ 'ì•„ ë­ì•¼ ëª°ë¼'í•˜ê³  ë„˜ì–´ê°ˆ ìˆ˜ ìˆì§€ë§Œ **ë‚˜ëŠ” ì´ë²ˆë§Œí¼ì€ ëì„ ë´ì•¼í•œë‹¤.**

![alt text]({{site.url}}/assets/img/unbalanced_dataset.png)

ë³´ë©´, bufferë¥¼ ëœë¤í•˜ê²Œ shuffleí•˜ê³  plotì„ í•´ë³´ì•˜ëŠ”ë°, **ë°ì´í„°ì˜ ìƒë‹¹í•œ í¸í–¥**ì„ ë°œê²¬í–ˆë‹¤. 224x224ëŠ” ë™ì¼í•˜ê²Œ cropí–ˆì§€ë§Œ 1.7x ì¢‹ì•„ì„œ croppdì—ì„œ 3:1 ì •ë„ë¡œ imageê°€ ë§ì€ ê²ƒì„ í™•ì¸í–ˆë‹¤. ë°ì´í„°ì˜ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶°ì„œ ë‹¤ì‹œ í•™ìŠµì„ í•´ë³´ì•„ì•¼ê² ë‹¤.

![alt text]({{site.url}}/assets/img/balanced_dataset.png)

sample loadí•˜ê³  spiltí•˜ëŠ” ì½”ë“œì— min_countë¡œ ê°€ì¥ ê°¯ìˆ˜ê°€ ì ì€ labelì— ëŒ€í•´ì„œ 1:1ë¡œ data balanceë¥¼ ë§ì¶œ ìˆ˜ ìˆê²Œ í•˜ì˜€ë‹¤.<br>
+optimizerë¥¼ admaì—ì„œ sgd 0.01 momentum 0.9 weight_decay=5e-4ë¡œ í•˜ê³ , 50step ë§ˆë‹¤ opt updateí•˜ë„ë¡ ìˆ˜ì • 

ğŸ“– module.load_weightsë¡œ .npz loadë¥¼ í•˜ê³  unseen dataì— ëŒ€í•´ì„œ ì ìš©í•´ë³¸ ê²°ê³¼ ê±°ì˜ ëª¨ë“  ê²½ìš°ì—ì„œ ì˜¬ë°”ë¥¸ ì˜ˆì¸¡ì„ í•˜ì˜€ë‹¤.<br>
í•˜ì§€ë§Œ, í•´ë‹¹ ê²°ê³¼ë¥¼ ë°±íŠ¸ë˜í‚¹í•´ë³´ë‹ˆ, wiener2 7x7 í•„í„°ë§Œ ì ìš©í•´ë„ Discriminatorë¥¼ ì „ë¶€ ì†ì´ëŠ” ê²ƒì´ ê°€ëŠ¥í–ˆë‹¤. + noiseë¥¼ ì¶”ê°€í•´ë„ ì•ˆë¨<br>
ë”°ë¼ì„œ ë°ì´í„°ë¥¼ ì¡°ê¸ˆ ë” ê°€ê³µí•´ì„œ ë‹¤ì‹œ í•™ìŠµì„ ì‹œì¼œì•¼ ê² ë‹¤. ê·¸ë¦¬ê³  ì ‘ê·¼ë²•ì„ ì—¬ëŸ¬ê°€ì§€ì˜ chainìœ¼ë¡œ ê°€ì ¸ê°€ëŠ” ê²ƒì´ ë§ì„ ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ë“ ë‹¤.

<br>
### ğŸ“Œ References
ğŸ§· https://ml-explore.github.io/mlx-data/build/html/index.html<br>
ğŸ§· https://ml-explore.github.io/mlx/build/html/index.html<br>
ğŸ§· https://blog.jaeyoon.io/2017/12/jekyll-image.html<br>

<!-- --- -->
<!-- 
#### Contact
ğŸ“ **Phone** : +82 10-6654-9551 <br>
ğŸ“§ **Email** : [kdhluck@naver.com](mailto:kdhluck@naver.com) -->